use pulldown_cmark::{Parser, html::push_html};

pub struct Renderer;

impl Renderer {
    pub fn render_to_html(markdown: &str) -> String {
        let parser = Parser::new(markdown);
        let mut html_output = String::new();
        push_html(&mut html_output, parser);
        Self::add_styling_with_bootstrap(&mut html_output);
        html_output
    }

    fn add_styling_with_bootstrap(html: &mut String) {
        let bootstrap_cdn = r#"<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">"#;

        let styled_html = format!(
            r#"<!DOCTYPE html>
            <html lang='en'>
            <head>
                <meta charset='UTF-8'>
                <meta name='viewport' content='width=device-width, initial-scale=1.0'>
                {bootstrap_cdn}
                <style>
                    body {{
                        background-color: #343a40; /* Dark background for the body */
                        color: #f8f9fa; /* Light text color */
                        padding-top: 2rem;
                        padding-bottom: 2rem;
                    }}
                    .container {{
                        max-width: 960px;
                    }}
                    pre {{
                        background-color: #23272b; /* Slightly lighter dark background for code blocks */
                        border: 1px solid #444; /* Darker border for emphasis */
                        border-radius: .25rem;
                        color: #f8f9fa;
                    }}
                    code {{
                        background-color: #23272b;
                        border-radius: .25rem;
                        color: #f8f9fa;
                    }}
                </style>
            </head>
            <body>
                <div class='container'>
                    {html}  <!-- Removed static title to handle markdown content dynamically -->
                </div>
            </body>
            </html>"#,
            bootstrap_cdn = bootstrap_cdn,
            html = html
        );

        *html = styled_html;
    }
}
